<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>scikit-rt &mdash; Scikit-rt 0.3.38 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Image registration with scikit-rt and elastix" href="image_registration.html" />
    <link rel="prev" title="Scikit-rt" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Scikit-rt
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Installation and usage:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">scikit-rt</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#help-and-support">Help and support</a></li>
<li class="toctree-l2"><a class="reference internal" href="#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#updating-scikit-rt">Updating scikit-rt</a></li>
<li class="toctree-l2"><a class="reference internal" href="#elastix-installation">Elastix installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#usage-information">Usage information</a></li>
<li class="toctree-l2"><a class="reference internal" href="#table-of-contents">Table of contents</a></li>
<li class="toctree-l2"><a class="reference internal" href="#images">1. Images</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#loading-from-a-file">Loading from a file</a></li>
<li class="toctree-l3"><a class="reference internal" href="#loading-from-an-array">Loading from an array</a></li>
<li class="toctree-l3"><a class="reference internal" href="#plotting">Plotting</a></li>
<li class="toctree-l3"><a class="reference internal" href="#writing-out-image-data">Writing out image data</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#writing-to-dicom">Writing to dicom</a></li>
<li class="toctree-l4"><a class="reference internal" href="#writing-to-nifti">Writing to nifti</a></li>
<li class="toctree-l4"><a class="reference internal" href="#writing-to-a-numpy-array">Writing to a numpy array</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#regions-of-interest-rois-and-structure-sets">2. Regions of interest (ROIs) and structure sets</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#the-roi-class">The ROI class</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#plotting-an-roi">Plotting an ROI</a></li>
<li class="toctree-l4"><a class="reference internal" href="#writing-out-an-roi">Writing out an ROI</a></li>
<li class="toctree-l4"><a class="reference internal" href="#getting-geometric-properties">Getting geometric properties</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#structure-sets-the-structureset-class">Structure Sets: the StructureSet class</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#loading-a-structure-set">Loading a structure set</a></li>
<li class="toctree-l4"><a class="reference internal" href="#creating-a-filtered-copy-of-a-structure-set">Creating a filtered copy of a structure set</a></li>
<li class="toctree-l4"><a class="reference internal" href="#renaming-rois">Renaming ROIs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#getting-rois">Getting ROIs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#filtering-a-structure-set">Filtering a structure set</a></li>
<li class="toctree-l4"><a class="reference internal" href="#writing-a-structure-set">Writing a structure set</a></li>
<li class="toctree-l4"><a class="reference internal" href="#assigning-structuresets-to-an-image">Assigning StructureSets to an Image</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#patients-and-studies">3. Patients and studies</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#sorted-data">Sorted data</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#patient-and-study-file-structure">Patient and study file structure</a></li>
<li class="toctree-l4"><a class="reference internal" href="#files-within-a-study">Files within a study</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#the-patient-class">The Patient class</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#sorted-and-unsorted-dicom-file">Sorted and unsorted DICOM file</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#the-study-class">The Study class</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id1">Images</a></li>
<li class="toctree-l4"><a class="reference internal" href="#structure-sets">Structure sets</a></li>
<li class="toctree-l4"><a class="reference internal" href="#treatment-plans">Treatment plans</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#synthetic-data">4. Synthetic data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#synthetic-images">4.1 Synthetic images</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#creating-a-synthetic-image">Creating a synthetic image</a></li>
<li class="toctree-l4"><a class="reference internal" href="#adding-structures">Adding structures</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#synthetic-patient-objects">4.2 Synthetic Patient objects</a></li>
<li class="toctree-l3"><a class="reference internal" href="#image-registration">5. Image registration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#keyboard-shortcuts-for-pop-out-interactive-viewer">6. Keyboard shortcuts for pop-out interactive viewer</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="image_registration.html">Image registration with scikit-rt and elastix</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Code documentation:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="skrt_modules.html">skrt</a></li>
<li class="toctree-l1"><a class="reference internal" href="voxtox_modules.html">voxtox</a></li>
<li class="toctree-l1"><a class="reference internal" href="import_analysis_modules.html">import_analysis</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Scikit-rt</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">scikit-rt</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/README.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="scikit-rt">
<h1>scikit-rt<a class="headerlink" href="#scikit-rt" title="Permalink to this heading"></a></h1>
<p>Scikit-rt provides tools for loading, plotting, and analysing
radiotherapy data in <a class="reference external" href="https://www.dicomstandard.org/">DICOM</a> and
<a class="reference external" href="https://nifti.nimh.nih.gov/">NIfTI</a> formats.  It includes
image registration via <a class="reference external" href="https://elastix.lumc.nl/">elastix</a>,
single- and multi-atlas segmentation, and region-of-interest (ROI)
comparisons.</p>
<p>This work was supported by Cancer Research UK RadNet Cambridge [C17918/A28870].</p>
<p>For full code documentation, see: <br/>
<a class="reference external" href="https://scikit-rt.github.io/scikit-rt/skrt_modules.html">https://scikit-rt.github.io/scikit-rt/skrt_modules.html</a>.</p>
<section id="help-and-support">
<h2>Help and support<a class="headerlink" href="#help-and-support" title="Permalink to this heading"></a></h2>
<p>If you encounter problems with scikit-rt, please submit a help request
or bug report via the project issues tracker: <br/>
<a class="reference external" href="https://github.com/scikit-rt/scikit-rt/issues">https://github.com/scikit-rt/scikit-rt/issues</a></p>
</section>
<section id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this heading"></a></h2>
<p>Scikit-rt has a number of dependencies.  To avoid possible version conflicts,
it’s recommended that it be installed to a clean virtual
environment.  This is achieved in the instructions below using
<a class="reference external" href="https://docs.conda.io/">conda</a>.  You can perform a user installation
with <a class="reference external" href="https://pip.pypa.io/">pip</a>, or a developer installation with
<a class="reference external" href="https://git-scm.com/">git</a>.   Installations have been tested
for <a class="reference external" href="https://www.python.org/downloads/release/python-380/">Python 3.8</a>.</p>
<ol class="arabic simple">
<li><p>User installation</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">conda</span> <span class="n">create</span> <span class="o">--</span><span class="n">name</span> <span class="n">skrt</span> <span class="n">python</span><span class="o">=</span><span class="mf">3.8</span>
<span class="n">conda</span> <span class="n">activate</span> <span class="n">skrt</span>
<span class="n">pip</span> <span class="n">install</span> <span class="n">scikit</span><span class="o">-</span><span class="n">rt</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Developer installation</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">scikit</span><span class="o">-</span><span class="n">rt</span><span class="o">/</span><span class="n">scikit</span><span class="o">-</span><span class="n">rt</span>
<span class="n">cd</span> <span class="n">scikit</span><span class="o">-</span><span class="n">rt</span>
<span class="n">conda</span> <span class="n">env</span> <span class="n">create</span> <span class="o">--</span><span class="n">file</span> <span class="n">environment</span><span class="o">.</span><span class="n">yml</span>
<span class="n">conda</span> <span class="n">activate</span> <span class="n">skrt</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>Environment activation and deactivation</p></li>
</ol>
<p>Following either of the installations above, the scikit-rt environment
is activated.  More generally, the environment can be activated
and deactivated with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Activate envrionment</span>
<span class="n">conda</span> <span class="n">activate</span> <span class="n">skrt</span>

<span class="c1"># Deactivate environment</span>
<span class="n">conda</span> <span class="n">deactivate</span>
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>Installation test
As a minimal test that the installation has been successful, try:</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">c</span> <span class="s2">&quot;import skrt; print(skrt.__version__)&quot;</span>
</pre></div>
</div>
<p>This may take some time, while python code is being compiled, but
should eventually print the scikit-rt version number, and exit without errors.</p>
</section>
<section id="updating-scikit-rt">
<h2>Updating scikit-rt<a class="headerlink" href="#updating-scikit-rt" title="Permalink to this heading"></a></h2>
<p>Scikit-rt is in active development. Following an initial installation,
it’s possible to update to the latest version.</p>
<ol class="arabic simple">
<li><p>User installation</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="o">--</span><span class="n">upgrade</span> <span class="n">scikit</span><span class="o">-</span><span class="n">rt</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Developer installation
From the scikit-rt directory, and assuming that no unmerged changes have
been made to the local copy of the code:</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">pull</span>
</pre></div>
</div>
</section>
<section id="elastix-installation">
<h2>Elastix installation<a class="headerlink" href="#elastix-installation" title="Permalink to this heading"></a></h2>
<p>Elastix installation is optional, but is needed for scikit-rt functionality
relating to image registration and atlas-based segmentation.</p>
<ol class="arabic simple">
<li><p>Download the latest version of elastix matching your operating system from <a class="reference external" href="https://elastix.lumc.nl/download.php">https://elastix.lumc.nl/download.php</a>.</p></li>
<li><p>Unzip the downloaded folder and place it somewhere. Make a note of where you stored it.</p></li>
<li><p>On Mac/Linux, you can also add the location of the elastix install to your environment by adding the following lines to your <code class="docutils literal notranslate"><span class="pre">~/.zshrc</span></code> or <code class="docutils literal notranslate"><span class="pre">~/.bashrc</span></code>:</p></li>
</ol>
<p>On Mac:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>export PATH=${PATH}:/path/to/elastix/directory/bin
export DYLD_LIBRARY_PATH=${DYLD_LIBRARY_PATH}:/path/to/elastix/directory/lib
</pre></div>
</div>
<p>On Linux:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>export PATH=${PATH}:/path/to/elastix/directory/bin
export LD_LIBRARY_PATH=${LD_LIBRARY_PATH}:/path/to/elastix/directory/lib
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>If you are on Windows or didn’t follow step 3, any time that you want to use image registration or atlas-based segmentation in scikit-rt, you will need to run:</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">skrt.registration</span> <span class="kn">import</span> <span class="n">set_elastix_dir</span>
<span class="n">set_elastix_dir</span><span class="p">(</span><span class="s1">&#39;path/to/elastix/directory&#39;</span><span class="p">)</span>
</pre></div>
</div>
<!---
### Docker installation

You need to have an installation of [Docker](https://www.docker.com/).

Download the Scikit-rt docker image with:

```
docker pull ghcr.io/scikit-rt/scikit-rt:latest
```

Choose a work directory, copy here any data that you would want to be able to
access with Scikit-rt, then start a docker container:

```
docker run -v /path/to/work/directory:/home/jovyan/workdir -p 8888:8888 ghcr.io/scikit-rt/scikit-rt
```

Copy the last URL listed (starting: http://127.0.0.1:8888), and point a browser to this URL.  This should open a jupyter lab session, where you import
Scikit-rt modules.

Notes on arguments passed to `docker run`:
- The argument to `-v` maps a local work directory (/path/to/work/directory) to 
the work directory of the docker container (/home/jovyan/workdir).  The former
is chosen by the user; the latter is fixed.  Paths should always be absolute
 (not relative).
- The argument to `-p` maps the server port (8888) on the local machine to the
server port (8888) on the container side.
--->
</section>
<section id="usage-information">
<h2>Usage information<a class="headerlink" href="#usage-information" title="Permalink to this heading"></a></h2>
<p>Scikit-rt can be used in scripts to be run from the command line, or in <a class="reference external" href="https://jupyter.org/">Jupyter</a>, where interactive features are enabled for image viewing.  The Scikit-rt installation includes both <a class="reference external" href="https://jupyter-notebook.readthedocs.io/en/latest/">Jupyter Notebook</a> and <a class="reference external" href="https://github.com/jupyterlab/jupyterlab">JupyterLab</a>.</p>
<p>Notebooks demonstrating scikit-rt functionality, using publicly accessible
or synthetic data, are available as follows:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/scikit-rt/scikit-rt/raw/master/examples/notebooks/plotting_demo.ipynb">plotting_demo.ipynb</a> demonstrates plotting capabilities;</p></li>
<li><p><a class="reference external" href="https://github.com/scikit-rt/scikit-rt/raw/master/examples/notebooks/application_demo.ipynb">application_demo.ipynb</a> demonstrates definition and
running of a scikit-rt application, for (non-interactive) processing
of datasets for multiple patients;</p></li>
<li><p><a class="reference external" href="https://github.com/scikit-rt/scikit-rt/raw/master/examples/notebooks/image_registration_checks.ipynb">image_registration_checks.ipynb</a> demonstrates
image registration, and qualitative checking of results (requires
<a class="reference external" href="https://elastix.lumc.nl/">elastix</a> to be installed).</p></li>
</ul>
<p>Each notebook can be downloaded by right-clicking on the link given,
and saving with extention <code class="docutils literal notranslate"><span class="pre">.ipynb</span></code>.  After download, a notebook
can be loaded in Jupyter with, for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">jupyter</span> <span class="n">lab</span> <span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">notebook</span>
</pre></div>
</div>
<p>Scikit-rt is able to load <a class="reference external" href="https://www.dicomstandard.org/current">DICOM</a> data (images, RTDOSE, RTSTRUCT, RTPLAN) and <a class="reference external" href="https://nifti.nimh.nih.gov/">NIfTI</a> data
(images, dose images, regions of interest (ROIs) represented as masks), and to convert between them.</p>
<p>The different types of radiotherapy data are represented in scikit-rt as
different types of object: <a class="reference external" href="https://scikit-rt.github.io/scikit-rt/skrt.image.html#skrt.image.Image">Image</a>, <a class="reference external" href="https://scikit-rt.github.io/scikit-rt/skrt.structures.html#skrt.structures.StructureSet">StructureSet</a>, <a class="reference external" href="https://scikit-rt.github.io/scikit-rt/skrt.structures.html#skrt.structures.ROI">ROI</a>
(region of interest), <a class="reference external" href="https://scikit-rt.github.io/scikit-rt/skrt.dose.html#skrt.dose.Plan">Plan</a>, <a class="reference external" href="https://scikit-rt.github.io/scikit-rt/skrt.dose.html#skrt.dose.Dose">Dose</a>.  The different types of data may be loaded and worked with independently of one another, or may be grouped and linked by loading via <a class="reference external" href="https://scikit-rt.github.io/scikit-rt/skrt.patient.html#skrt.patient.Study">Study</a> or <a class="reference external" href="https://scikit-rt.github.io/scikit-rt/skrt.patient.html#skrt.patient.Patient">Patient</a> objects.</p>
<p>Usage information, and code examples, for working with the different types of scikit-rt data objects are given below.  Information is also given on generation
and use of synthetic data, image registration, and keyboard shortcuts for
interactive image viewing outside of a Jupyter notebook.</p>
</section>
<section id="table-of-contents">
<h2>Table of contents<a class="headerlink" href="#table-of-contents" title="Permalink to this heading"></a></h2>
<ol class="arabic simple">
<li><p><a class="reference internal" href="#images"><span class="xref myst">Images</span></a></p></li>
<li><p><a class="reference internal" href="#regions-of-interest-rois-and-structure-sets"><span class="xref myst">Regions of interest (ROIs) and structure sets</span></a></p></li>
<li><p><a class="reference internal" href="#patients-and-studies"><span class="xref myst">Patients and studies</span></a></p></li>
<li><p><a class="reference internal" href="#synthetic-data"><span class="xref myst">Synthetic data</span></a></p></li>
<li><p><a class="reference internal" href="image_registration.html"><span class="std std-doc">Image registration</span></a></p></li>
<li><p><a class="reference internal" href="#keyboard-shortcuts-for-pop-out-interactive-viewer"><span class="xref myst">Keyboard shortcuts for pop-out interactive viewer</span></a></p></li>
</ol>
</section>
<section id="images">
<h2>1. Images<a class="headerlink" href="#images" title="Permalink to this heading"></a></h2>
<p>The Image class can be used to read and write images in DICOM, NIfTI,
or NumPy format. These images can be plotted and compared.</p>
<p>To load the Image class:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">skrt</span> <span class="kn">import</span> <span class="n">Image</span>
</pre></div>
</div>
<p>Images will be processed into a consistent format:</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">Image.data</span></code> property contains a numpy array, which stores (y, x, z) in (row, column, slice) respectively. Note that numpy elements are indexed in order (row, column, slice); so if you did <code class="docutils literal notranslate"><span class="pre">Image.data[i,</span> <span class="pre">j,</span> <span class="pre">k]</span></code>, <code class="docutils literal notranslate"><span class="pre">i</span></code> would correspond to y index, <code class="docutils literal notranslate"><span class="pre">j</span></code> would correspond to x index, <code class="docutils literal notranslate"><span class="pre">k</span></code> would correspond to z index.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">Image.affine</span></code> property contains a 4x4 matrix that can convert a (row, column, slice) index to an (x, y, z) position. This will always be diagonal, so (0, 0) contains x voxel size etc, (0, 3) contains x origin.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">voxel_size</span></code> and <code class="docutils literal notranslate"><span class="pre">origin</span></code> properties are the diagonal and third column, respectively; they give voxel sizes and origin position in order (x, y, z).</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">n_voxels</span></code> property containins the number of voxels in the (x, y, z) directions (same as <code class="docutils literal notranslate"><span class="pre">Image.data.shape</span></code>, but with 0 and 1 swapped).</p></li>
</ul>
<p>In the standard dicom-style configuration (Left, Posterior, Superior):</p>
<ul class="simple">
<li><p>The x-axis increases along each column, and points towards the patient’s left (i.e. towards the heart, away from the liver).</p></li>
<li><p>The y-axis increase down each row, and points from the patient’s front to back (posterior).</p></li>
<li><p>The z-axis increases along the slice index, and points from the patient’s feet to head (superior).</p></li>
</ul>
<p>A canonical nifti-style array and affine can be obtained by running <code class="docutils literal notranslate"><span class="pre">Image.get_nifti_array_and_affine()</span></code>. By convention, this points in the same z direction but has x and y axes reversed (Right, Anterior, Superior). In the affine matrix, the x and y origins are therefore defined as being at the opposite end of the scale.</p>
<p>Note that positions can also be specified in terms of slice number:</p>
<ul class="simple">
<li><p>For x and y, slice number is just numpy array index + 1 (slice number ranges from 1 - n_voxels, whereas array index ranges from 0 - n_voxels-1)</p></li>
<li><p>For z, by convention the slice numbers increases from 1 at the head to n_voxels at the feet, so it is in the opposite direction to the array index (convert as n_voxels[2] - idx).</p></li>
</ul>
<section id="loading-from-a-file">
<h3>Loading from a file<a class="headerlink" href="#loading-from-a-file" title="Permalink to this heading"></a></h3>
<p>An image can be loaded from a dicom, nifti, or numpy file via:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">im</span> <span class="o">=</span> <span class="n">Image</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
</pre></div>
</div>
<p>If the dicom file is part of a series, any other files in that series in the same directory will also be loaded. Alternatively, you can give the path to a directory containing multiple dicom files. The first dicom file in that directory alphabetically will be loaded along with any other files in its series.</p>
</section>
<section id="loading-from-an-array">
<h3>Loading from an array<a class="headerlink" href="#loading-from-an-array" title="Permalink to this heading"></a></h3>
<p>An image can also be loaded from a numpy array. By default, it will be taken to have origin (0, 0, 0) and voxel sizes (1, 1, 1) mm; otherwise, these can be set manually, either via:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">im</span> <span class="o">=</span> <span class="n">Image</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">voxel_size</span><span class="o">=</span><span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">origin</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="mi">40</span><span class="p">))</span>
</pre></div>
</div>
<p>where the origin/voxel size lists are in order (x, y, z).</p>
<p>The origin and voxel sizes can also be specified via an affine matrix, e.g.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">affine</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
    <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">100</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">100</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">40</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="p">])</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">Image</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">affine</span><span class="o">=</span><span class="n">affine</span><span class="p">)</span>
</pre></div>
</div>
<p>where the first row of the affine matrix contains the <code class="docutils literal notranslate"><span class="pre">x</span></code> voxel size and origin, second row contains <code class="docutils literal notranslate"><span class="pre">y</span></code>, third row contains <code class="docutils literal notranslate"><span class="pre">z</span></code>.</p>
</section>
<section id="plotting">
<h3>Plotting<a class="headerlink" href="#plotting" title="Permalink to this heading"></a></h3>
<p>To plot a slice of the image, you need to specify the orientation (<code class="docutils literal notranslate"><span class="pre">x-y</span></code>, <code class="docutils literal notranslate"><span class="pre">y-z</span></code>, or <code class="docutils literal notranslate"><span class="pre">x-z</span></code>; default <code class="docutils literal notranslate"><span class="pre">x-y</span></code>) and either the slice number, array index, or position in mm (by default, the central slice in the chosen orientation will be plotted).
e.g.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">im</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;y-z&#39;</span><span class="p">,</span> <span class="n">idx</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="writing-out-image-data">
<h3>Writing out image data<a class="headerlink" href="#writing-out-image-data" title="Permalink to this heading"></a></h3>
<p>Images can be written out with the <code class="docutils literal notranslate"><span class="pre">Image.write(filename)</span></code> function. The output filetype will be inferred from the filename.</p>
<section id="writing-to-dicom">
<h4>Writing to dicom<a class="headerlink" href="#writing-to-dicom" title="Permalink to this heading"></a></h4>
<p>If <code class="docutils literal notranslate"><span class="pre">filename</span></code> ends in <code class="docutils literal notranslate"><span class="pre">.dcm</span></code> or is a directory (i.e. has no extension), the image will be written in dicom format. Each <code class="docutils literal notranslate"><span class="pre">x-y</span></code> slice will be written to a separate file labelled by slice number, e.g. slice 1 (corresponding to <code class="docutils literal notranslate"><span class="pre">[:,</span> <span class="pre">:,</span> <span class="pre">-1]</span></code> in the image array) would be saved to <code class="docutils literal notranslate"><span class="pre">1.dcm</span></code>.</p>
<p>The path to a dicom file from which to take the header can be specified via the <code class="docutils literal notranslate"><span class="pre">header_source</span></code> parameter. If no path is given but the input source for the Image was a dicom file, the header will be taken from the source. Otherwise (e.g. if the file was loaded from a nifti and no <code class="docutils literal notranslate"><span class="pre">header_source</span></code> is given), a brand new header with new UIDs will be created. In that case, you can set the following info for that header:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">patient_id</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">modality</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">root_uid</span></code> (an ID unique to your institue that will prefix the generated dicom UIDs so that they are globally unique; one can be obtained here: https://www.medicalconnections.co.uk/FreeUID/)</p></li>
</ul>
</section>
<section id="writing-to-nifti">
<h4>Writing to nifti<a class="headerlink" href="#writing-to-nifti" title="Permalink to this heading"></a></h4>
<p>If <code class="docutils literal notranslate"><span class="pre">filename</span></code> ends in <code class="docutils literal notranslate"><span class="pre">.nii</span></code> or <code class="docutils literal notranslate"><span class="pre">.nii.gz</span></code>, the image will be written to nifti. The nifti will be in canonical format, i.e. in Right, Anterior, Superior configuration. (Note that this means the nifti you write out may not be the same as the one you read in).</p>
</section>
<section id="writing-to-a-numpy-array">
<h4>Writing to a numpy array<a class="headerlink" href="#writing-to-a-numpy-array" title="Permalink to this heading"></a></h4>
<p>If <code class="docutils literal notranslate"><span class="pre">filename</span></code> ends in <code class="docutils literal notranslate"><span class="pre">.npy</span></code>, the image array will be written to a numpy binary file. To write a canonical nifti-style array instead of the dicom-style array, set <code class="docutils literal notranslate"><span class="pre">nifti_array=True</span></code>. If <code class="docutils literal notranslate"><span class="pre">set_geometry</span></code> is <code class="docutils literal notranslate"><span class="pre">True</span></code> (which it is by default), a text file will be written to the same directory as the <code class="docutils literal notranslate"><span class="pre">.npy</span></code> file containing the voxel sizes and origin.</p>
</section>
</section>
</section>
<section id="regions-of-interest-rois-and-structure-sets">
<h2>2. Regions of interest (ROIs) and structure sets<a class="headerlink" href="#regions-of-interest-rois-and-structure-sets" title="Permalink to this heading"></a></h2>
<p>A structure/region of interest (ROI) can be represented by either a set of contour points or a binary mask. The <code class="docutils literal notranslate"><span class="pre">ROI</span></code> class allows an ROI to be loaded from either of these sources and converted from one to the other.</p>
<section id="the-roi-class">
<h3>The ROI class<a class="headerlink" href="#the-roi-class" title="Permalink to this heading"></a></h3>
<p>An <code class="docutils literal notranslate"><span class="pre">ROI</span></code> object, which contains a single ROI, can be created via:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">skrt</span> <span class="kn">import</span> <span class="n">ROI</span>
<span class="n">roi</span> <span class="o">=</span> <span class="n">ROI</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">source</span></code> can be from any of the following:</p>
<ul class="simple">
<li><p>A dicom structure set file containing one or more sets of contours;</p></li>
<li><p>A dictionary of contours, where the keys are slice positions in mm and the values are lists of lists of contour points for each contour on that slice;</p></li>
<li><p>A nifti file containing a binary mask;</p></li>
<li><p>A numpy file containing a binary mask;</p></li>
<li><p>A numpy array.</p></li>
</ul>
<p>If the input object is a dicom file, the name of the ROI within that file must be given. In addition, if the input source is a dicom file or contour dictionary, in order to convert the contours to a mask, the user must provide either of the following arguments to the <code class="docutils literal notranslate"><span class="pre">ROI</span></code> creation:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">image</span></code>: Assign an <code class="docutils literal notranslate"><span class="pre">Image</span></code> object associated with this ROI. The created mask will have the same dimensions as this image.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">shape</span></code>, <code class="docutils literal notranslate"><span class="pre">origin</span></code>, and <code class="docutils literal notranslate"><span class="pre">voxel_sizes</span></code>: This tells the ROI the dimensions of the pixel array to create when making the mask.</p></li>
</ul>
<p>Additional useful arguments are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">color</span></code>: set the colour of this ROI for plotting. If not specified, this will either be read from the dicom file (if given) or the ROI will be assigned a unique colour.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">name</span></code>: set the name of this ROI. If the input is a dicom structure set file, this name will be used to select the correct ROI from the file. If not given, the ROI will be given a unique name (“ROI 1” etc)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">load</span></code>: if <code class="docutils literal notranslate"><span class="pre">True</span></code> (default), the input ROI will be converted into a mask/contours automatically upon creation. This can be time consuming if you are creating many ROIs, so setting it to <code class="docutils literal notranslate"><span class="pre">False</span></code> can save time and allow ROIs to be processed later on-demand.</p></li>
</ul>
<p>An <code class="docutils literal notranslate"><span class="pre">Image</span></code> object associated with this ROI can be set at any time via:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">roi</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">image</span>
</pre></div>
</div>
<p>This image can optionally be plotted in the background when the ROI is plotted.</p>
<section id="plotting-an-roi">
<h4>Plotting an ROI<a class="headerlink" href="#plotting-an-roi" title="Permalink to this heading"></a></h4>
<p>ROIs can be plotted as contours or a mask or both, and with or without an associated image behind them. The simplest plot command is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">roi</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
<p>This will plot a contour in the x-y plane, e.g.:</p>
<img src="_static/struct_contour.png" alt="ROI contour plot" height="500"/>
<p>Additional options are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">include_image</span></code>: boolean, set to <code class="docutils literal notranslate"><span class="pre">True</span></code> to plot the associated image (if one is assigned) in the background;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">view</span></code>: specify the orientation (<code class="docutils literal notranslate"><span class="pre">x-y</span></code>, <code class="docutils literal notranslate"><span class="pre">y-z</span></code>, or <code class="docutils literal notranslate"><span class="pre">x-z</span></code>);</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sl</span></code>, <code class="docutils literal notranslate"><span class="pre">pos</span></code>, or <code class="docutils literal notranslate"><span class="pre">idx</span></code>: specify the slice number, slice position in mm, or slice index;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">zoom</span></code>: amount by which to zoom in (will automatically zoom in on the centre of the ROI).</p></li>
</ul>
<p>The following plot types are available, set via the <code class="docutils literal notranslate"><span class="pre">plot_type</span></code> argument:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">contour</span></code>: plot a contour</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mask</span></code>: plot a binary mask</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">filled</span></code>: plot a contour on top of a semi-transparent mask</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">centroid</span></code>: plot a contour with the centroid marked by a cross</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">filled</span> <span class="pre">centroid</span></code>: plot a contour and centroid on top of a semi-transparent mask</p></li>
</ul>
<p>Example contour plot with <code class="docutils literal notranslate"><span class="pre">include_image=True</span></code>:</p>
<img src="_static/struct_contour_with_image.png" alt="ROI contour plot with image" height="500"/>
<p>Example mask plot:</p>
<img src="_static/struct_mask.png" alt="ROI binary mask plot" height="500"/>
</section>
<section id="writing-out-an-roi">
<h4>Writing out an ROI<a class="headerlink" href="#writing-out-an-roi" title="Permalink to this heading"></a></h4>
<p>An ROI can be written to a nifti or numpy file as a binary mask. This can be done either by specifying a filename with an appropriate extension, e.g.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">roi</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;my_roi.nii&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>would automatically write to a nifti file.</p>
<p>Alternatively, the ROI’s name can be used to create the filename. This is done by just providing an extension, e.g. if an ROI were called “heart”, the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">roi</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ext</span><span class="o">=</span><span class="s1">&#39;.nii&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>would produce a file called <code class="docutils literal notranslate"><span class="pre">heart.nii</span></code> containing the ROI as a binary mask. An output directory can also be optionally provided, e.g.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">roi</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">outdir</span><span class="o">=</span><span class="s1">&#39;my_rois&#39;</span><span class="p">,</span> <span class="n">ext</span><span class="o">=</span><span class="s1">&#39;.npy&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>would produce a binary numpy file at <code class="docutils literal notranslate"><span class="pre">my_rois/heart.npy</span></code>.</p>
</section>
<section id="getting-geometric-properties">
<h4>Getting geometric properties<a class="headerlink" href="#getting-geometric-properties" title="Permalink to this heading"></a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">ROI</span></code> class has various methods for obtaining geometric properties of the ROI:</p>
<ul class="simple">
<li><p><strong>Centroid</strong>: get the 3D centroid coordinates (i.e. the centre-of-mass of the ROI) in mm via <code class="docutils literal notranslate"><span class="pre">roi.get_centroid()</span></code>, or get the 2D coordinates for a single slice via <code class="docutils literal notranslate"><span class="pre">roi.get_centroid(view='x-y',</span> <span class="pre">sl=10)</span></code>, for example (the slice position in mm <code class="docutils literal notranslate"><span class="pre">pos</span></code> or slice index <code class="docutils literal notranslate"><span class="pre">idx</span></code> can be given instead of slice number <code class="docutils literal notranslate"><span class="pre">sl</span></code>)</p></li>
<li><p><strong>Centre</strong>: get the 3D midpoint coordinates (i.e. the mean of the maximum extents in each direction, rather than centre of mass) via <code class="docutils literal notranslate"><span class="pre">roi.get_centre()</span></code>. The 2D midpoint of a slice is obtained in a similar way to the centroid, e.g. <code class="docutils literal notranslate"><span class="pre">roi.get_centre(view='x-y',</span> <span class="pre">sl=10)</span></code>.</p></li>
<li><p><strong>Volume</strong>: <code class="docutils literal notranslate"><span class="pre">roi.get_volume(units)</span></code>, where <code class="docutils literal notranslate"><span class="pre">units</span></code> can either be <code class="docutils literal notranslate"><span class="pre">mm</span></code> or <code class="docutils literal notranslate"><span class="pre">voxels</span></code> (default <code class="docutils literal notranslate"><span class="pre">mm</span></code>).</p></li>
<li><p><strong>Area</strong>: get the area of a given slice of an ROI by running e.g. <code class="docutils literal notranslate"><span class="pre">roi.get_area(view='x-y',</span> <span class="pre">sl=10,</span> <span class="pre">units='mm')</span></code>. To get the area of the central slice, can simply run <code class="docutils literal notranslate"><span class="pre">roi.get_area()</span></code>.</p></li>
<li><p><strong>Length</strong>: get ROI length along a given axis by running <code class="docutils literal notranslate"><span class="pre">roi.get_length(axis,</span> <span class="pre">units)</span></code> where <code class="docutils literal notranslate"><span class="pre">axis</span></code> is <code class="docutils literal notranslate"><span class="pre">x</span></code>, <code class="docutils literal notranslate"><span class="pre">y</span></code>, or <code class="docutils literal notranslate"><span class="pre">z</span></code> and <code class="docutils literal notranslate"><span class="pre">units</span></code> is <code class="docutils literal notranslate"><span class="pre">mm</span></code> or <code class="docutils literal notranslate"><span class="pre">voxels</span></code>.</p></li>
</ul>
</section>
</section>
<section id="structure-sets-the-structureset-class">
<h3>Structure Sets: the StructureSet class<a class="headerlink" href="#structure-sets-the-structureset-class" title="Permalink to this heading"></a></h3>
<p>A structure set is an object that contains multiple ROIs. This is implemented via the <code class="docutils literal notranslate"><span class="pre">StructureSet</span></code> class.</p>
<section id="loading-a-structure-set">
<h4>Loading a structure set<a class="headerlink" href="#loading-a-structure-set" title="Permalink to this heading"></a></h4>
<p>A structure set is created via</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">skrt</span> <span class="kn">import</span> <span class="n">StructureSet</span>
<span class="n">structure_set</span> <span class="o">=</span> <span class="n">StructureSet</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
</pre></div>
</div>
<p>The source can be:</p>
<ul class="simple">
<li><p>The path to a dicom structure set file containing multiple ROIs;</p></li>
<li><p>The path to a directory containing one or more nifti or numpy files, each containing a binary ROI mask;</p></li>
<li><p>A list of paths to nifti or numpy ROI mask files.</p></li>
</ul>
<p>In addition, more ROIs can be added later via:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">structure_set</span><span class="o">.</span><span class="n">add_rois</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">source</span></code> is any of the above source types.</p>
<p>Alternatively, single ROIs can be added at a time via any of the valid <code class="docutils literal notranslate"><span class="pre">ROI</span></code> sources (see above), and with any of the <code class="docutils literal notranslate"><span class="pre">ROI</span></code> initialisation arguments. An empty <code class="docutils literal notranslate"><span class="pre">StructureSet</span></code> can be created and then populated, e.g.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">structure_set</span> <span class="o">=</span> <span class="n">StructureSet</span><span class="p">()</span>
<span class="n">structure_set</span><span class="o">.</span><span class="n">add_roi</span><span class="p">(</span><span class="s1">&#39;heart.nii&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">structure_set</span><span class="o">.</span><span class="n">add_roi</span><span class="p">(</span><span class="s1">&#39;some_structs.dcm&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;lung&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">StructureSet</span></code> can also be associated with an <code class="docutils literal notranslate"><span class="pre">Image</span></code> object by specifying the <code class="docutils literal notranslate"><span class="pre">image</span></code> argument upon creation, or running <code class="docutils literal notranslate"><span class="pre">structure_set.set_image(image)</span></code>. This image will be assigned to all ROIs in the structure set.</p>
</section>
<section id="creating-a-filtered-copy-of-a-structure-set">
<h4>Creating a filtered copy of a structure set<a class="headerlink" href="#creating-a-filtered-copy-of-a-structure-set" title="Permalink to this heading"></a></h4>
<p>Sometimes you may wish to load many ROIs (e.g. from a dicom structure set file) and then filter them by name. This is done via:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">structure_set</span><span class="o">.</span><span class="n">filter_rois</span><span class="p">(</span><span class="n">to_keep</span><span class="p">,</span> <span class="n">to_remove</span><span class="p">)</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">to_keep</span></code> and <code class="docutils literal notranslate"><span class="pre">to_remove</span></code> are optional lists containing ROI names, or wildcards with the <code class="docutils literal notranslate"><span class="pre">*</span></code> character. First, all of the ROIs belonging to <code class="docutils literal notranslate"><span class="pre">structure_set</span></code> are checked and only kept if they match the names or wildcards in <code class="docutils literal notranslate"><span class="pre">to_keep</span></code>. The remaining ROIs are then removed if their names match the names or wildcards in <code class="docutils literal notranslate"><span class="pre">to_remove</span></code>.</p>
<p>To restore a structure set to its original state (i.e. reload it from its source), run <code class="docutils literal notranslate"><span class="pre">structure_set.reset()</span></code>.</p>
</section>
<section id="renaming-rois">
<h4>Renaming ROIs<a class="headerlink" href="#renaming-rois" title="Permalink to this heading"></a></h4>
<p>ROIs can be renamed by mapping from one or more possible original names to a single final name. In this way, multiple structure sets where the same ROI might have different names can be standardised to have the same ROI names.</p>
<p>For example, let’s say you wish to rename the right parotid gland to <code class="docutils literal notranslate"><span class="pre">right_parotid</span></code>, but you know that it has a variety of names across different structure sets. You could do this with the following (assuming <code class="docutils literal notranslate"><span class="pre">my_structure_sets</span></code> is a list of <code class="docutils literal notranslate"><span class="pre">StructureSet</span></code> objects:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">names_map</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;right_parotid&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;right*parotid&#39;</span><span class="p">,</span> <span class="s1">&#39;parotid*right&#39;</span><span class="p">,</span> <span class="s1">&#39;R parotid&#39;</span><span class="p">,</span> <span class="s1">&#39;parotid_R&#39;</span><span class="p">]</span>
<span class="p">}</span>
<span class="k">for</span> <span class="n">structure_set</span> <span class="ow">in</span> <span class="n">my_structure_sets</span><span class="p">:</span>
    <span class="n">structure_set</span><span class="o">.</span><span class="n">rename_rois</span><span class="p">(</span><span class="n">names_map</span><span class="p">)</span>
</pre></div>
</div>
<p>By default, only one ROI per structure set will be renamed; for example, if a structure set for some reason contained both <code class="docutils literal notranslate"><span class="pre">right</span> <span class="pre">parotid</span></code> and <code class="docutils literal notranslate"><span class="pre">R</span> <span class="pre">parotid</span></code>, only the first in the list (<code class="docutils literal notranslate"><span class="pre">right</span> <span class="pre">parotid</span></code>) would be renamed. This behaviour can be turned off by setting <code class="docutils literal notranslate"><span class="pre">first_match_only=False</span></code>; beware this could lead to duplicate ROI names.</p>
<p>You can also choose to discard any ROIs that aren’t in your renaming map by setting <code class="docutils literal notranslate"><span class="pre">keep_renamed_only=True</span></code>.</p>
</section>
<section id="getting-rois">
<h4>Getting ROIs<a class="headerlink" href="#getting-rois" title="Permalink to this heading"></a></h4>
<p>Get a list of the <code class="docutils literal notranslate"><span class="pre">ROI</span></code> objects belonging to the structure set:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">structure_set</span><span class="o">.</span><span class="n">get_rois</span><span class="p">()</span>
</pre></div>
</div>
<p>Get a list of names of the <code class="docutils literal notranslate"><span class="pre">ROI</span></code> objects:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">structure_set</span><span class="o">.</span><span class="n">get_roi_names</span><span class="p">()</span>
</pre></div>
</div>
<p>Get a dictionary of <code class="docutils literal notranslate"><span class="pre">ROI</span></code> objects with their names as keys:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">structure_set</span><span class="o">.</span><span class="n">get_roi_dict</span><span class="p">()</span>
</pre></div>
</div>
<p>Get an <code class="docutils literal notranslate"><span class="pre">ROI</span></code> object with a specific name:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">structure_set</span><span class="o">.</span><span class="n">get_roi</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
<p>Print the <code class="docutils literal notranslate"><span class="pre">ROI</span></code> names:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">structure_set</span><span class="o">.</span><span class="n">print_rois</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="filtering-a-structure-set">
<h4>Filtering a structure set<a class="headerlink" href="#filtering-a-structure-set" title="Permalink to this heading"></a></h4>
<p>A <code class="docutils literal notranslate"><span class="pre">StructureSet</span></code> object can be copied to a new <code class="docutils literal notranslate"><span class="pre">StructureSet</span></code>, optionally with some ROIs filtered/renamed (you might want to do this if you want to preserve the original structure set, while making a filtered version too), via:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">filtered</span> <span class="o">=</span> <span class="n">structure_set</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">to_keep</span><span class="p">,</span> <span class="n">to_remove</span><span class="p">,</span> <span class="n">keep_renamed_only</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="writing-a-structure-set">
<h4>Writing a structure set<a class="headerlink" href="#writing-a-structure-set" title="Permalink to this heading"></a></h4>
<p>The ROIs in a structure set can be written to a directory of nifti or numpy files, via:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">structure_set</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">outdir</span><span class="p">,</span> <span class="n">ext</span><span class="p">)</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">outdir</span></code> is the output directory and <code class="docutils literal notranslate"><span class="pre">ext</span></code> is either <code class="docutils literal notranslate"><span class="pre">.nii</span></code>, <code class="docutils literal notranslate"><span class="pre">.nii.gz</span></code> or <code class="docutils literal notranslate"><span class="pre">.npy</span></code>. Dicom writing will be supported in future.</p>
</section>
<section id="assigning-structuresets-to-an-image">
<h4>Assigning StructureSets to an Image<a class="headerlink" href="#assigning-structuresets-to-an-image" title="Permalink to this heading"></a></h4>
<p>Just as ROIs and structure sets can be associated with an image, the <code class="docutils literal notranslate"><span class="pre">Image</span></code> object can be associated with one or more <code class="docutils literal notranslate"><span class="pre">StructureSet</span></code> objects. This is done via:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">skrt</span> <span class="kn">import</span> <span class="n">Image</span><span class="p">,</span> <span class="n">StructureSet</span>

<span class="n">image</span> <span class="o">=</span> <span class="n">Image</span><span class="p">(</span><span class="s2">&quot;some_image.nii&quot;</span><span class="p">)</span>
<span class="n">structure_set</span> <span class="o">=</span> <span class="n">StructureSet</span><span class="p">(</span><span class="s2">&quot;roi_directory&quot;</span><span class="p">)</span>

<span class="n">image</span><span class="o">.</span><span class="n">add_structure_set</span><span class="p">(</span><span class="n">structure_set</span><span class="p">)</span>
</pre></div>
</div>
<p>Now, when the <code class="docutils literal notranslate"><span class="pre">Image</span></code> is plotted, the ROIs in its structure set(s) can be plotted on top. To plot all structure sets, run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">image</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">structure_set</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that this could be slow if there are many structure sets containing many structures.</p>
<p>To plot just one structure set, you can also provide the index of the structure set in the list of structure sets belonging to the image, e.g. to plot the most recently added structure set:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">image</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">structure_set</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>To add a legend to the plot, set <code class="docutils literal notranslate"><span class="pre">roi_legend=True</span></code>.</p>
<p>The image’s structure sets can be cleared at any time via</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">image</span><span class="o">.</span><span class="n">clear_structure_sets</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="patients-and-studies">
<h2>3. Patients and studies<a class="headerlink" href="#patients-and-studies" title="Permalink to this heading"></a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">Patient</span></code> and <code class="docutils literal notranslate"><span class="pre">Study</span></code> classes allow multiple images and structure sets associated with a single patient to be read into one object.  These classes
can load DICOM and/or NIfTI files organised as described below (sorted data),
and can load arbitrarily organised DICOM files (unsorted data).  In the
cases of both sorted and unsorted data, all files relating to a single
patient should be placed under a separate directory, the name of which
is taken as the patient’s identifier.</p>
<section id="sorted-data">
<h3>Sorted data<a class="headerlink" href="#sorted-data" title="Permalink to this heading"></a></h3>
<section id="patient-and-study-file-structure">
<h4>Patient and study file structure<a class="headerlink" href="#patient-and-study-file-structure" title="Permalink to this heading"></a></h4>
<p>The top level directory represents the entire <strong>patient</strong>.</p>
<p>The next one or two levels represent <strong>studies</strong>. A study is identified by a directory whose name is a timestamp, which is a string with format <code class="docutils literal notranslate"><span class="pre">YYYYMMDD_hhmmss</span></code>. These directories can either appear within the patient directory, or be nested in a further level of directories, for example if you wished to separate groups of studies.</p>
<p>A valid file structure could look like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mypatient1</span>
<span class="o">---</span> <span class="mi">20200416_120350</span>
<span class="o">---</span> <span class="mi">20200528_100845</span>
</pre></div>
</div>
<p>This would represent a patient with ID <code class="docutils literal notranslate"><span class="pre">mypatient1</span></code>, with two studies, one taken on 16/04/2020 and one taken on 28/05/2020.</p>
<p>Another valid file structure could be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mypatient1</span>
<span class="o">---</span> <span class="n">planning</span>
<span class="o">------</span> <span class="mi">20200416_120350</span>
<span class="o">------</span> <span class="mi">20200528_100845</span>
<span class="o">---</span> <span class="n">relapse</span>
<span class="o">------</span> <span class="mi">20211020_093028</span>
</pre></div>
</div>
<p>This patient would have three studies, two in the “planning” category and two in the “relapse” category.</p>
</section>
<section id="files-within-a-study">
<h4>Files within a study<a class="headerlink" href="#files-within-a-study" title="Permalink to this heading"></a></h4>
<p>Each study can contain images of various imaging modalities, and associated structure sets. Within a study directory, there can be three “special” directories, named <code class="docutils literal notranslate"><span class="pre">RTSTRUCT</span></code>, <code class="docutils literal notranslate"><span class="pre">RTDOSE</span></code>, and <code class="docutils literal notranslate"><span class="pre">RTPLAN</span></code>, containing structure sets, dose fields, and radiotherapy plans, respectively.</p>
<p>Any other directories within the study directory are taken to represent an <strong>imaging modality</strong>. The structure sets associated with this modality should be nested inside the <code class="docutils literal notranslate"><span class="pre">RTSTRUCT</span></code> directory inside directories with the same name as the image directories. The images and structure sets themselves should be further nested inside a timestamp directory representing the time at which that image was taken.</p>
<p>For example, if a study containined both CT and MR images, as well as two structure sets associated with the CT image, the file structure should be as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">20200416_120350</span>
<span class="o">---</span> <span class="n">CT</span>
<span class="o">------</span> <span class="mi">20200416_120350</span>
<span class="o">---------</span> <span class="mf">1.</span><span class="n">dcm</span>
<span class="o">---------</span> <span class="mf">2.</span><span class="n">dcm</span> <span class="o">...</span> <span class="n">etc</span>
<span class="o">---</span> <span class="n">MR</span>
<span class="o">------</span> <span class="mi">20200417_160329</span>
<span class="o">---------</span> <span class="mf">1.</span><span class="n">dcm</span>
<span class="o">---------</span> <span class="mf">2.</span><span class="n">dcm</span> <span class="o">...</span> <span class="n">etc</span>
<span class="o">---</span> <span class="n">RTSTRUCT</span>
<span class="o">------</span> <span class="n">CT</span>
<span class="o">----------</span> <span class="mi">20200416_120350</span>
<span class="o">--------------</span> <span class="n">RTSTRUCT_20200512_134729</span><span class="o">.</span><span class="n">dcm</span>
<span class="o">--------------</span> <span class="n">RTSTRUCT_20200517_162739</span><span class="o">.</span><span class="n">dcm</span>
</pre></div>
</div>
</section>
</section>
<section id="the-patient-class">
<h3>The Patient class<a class="headerlink" href="#the-patient-class" title="Permalink to this heading"></a></h3>
<p>A <code class="docutils literal notranslate"><span class="pre">Patient</span></code> object is created by providing the path to the top-level patient directory, and indicating if the data are unsorted DICOM data:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">skrt</span> <span class="kn">import</span> <span class="n">Patient</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">Patient</span><span class="p">(</span><span class="s1">&#39;mypatient1&#39;</span><span class="p">)</span> <span class="c1"># load sorted data</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">Patient</span><span class="p">(</span><span class="s1">&#39;mypatient2&#39;</span><span class="p">,</span> <span class="n">unsorted_dicom</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># load unsorted DICOM data</span>
</pre></div>
</div>
<p>A list of the patient’s associated studies is stored in <code class="docutils literal notranslate"><span class="pre">p.studies</span></code>.</p>
<p>Additional properties can be accessed:</p>
<ul class="simple">
<li><p>Patient ID: <code class="docutils literal notranslate"><span class="pre">p.id</span></code></p></li>
<li><p>Patient sex: <code class="docutils literal notranslate"><span class="pre">p.get_sex()</span></code></p></li>
<li><p>Patient age: <code class="docutils literal notranslate"><span class="pre">p.get_age()</span></code></p></li>
<li><p>Patient birth date: <code class="docutils literal notranslate"><span class="pre">p.get_birth_date()</span></code></p></li>
</ul>
<section id="sorted-and-unsorted-dicom-file">
<h4>Sorted and unsorted DICOM file<a class="headerlink" href="#sorted-and-unsorted-dicom-file" title="Permalink to this heading"></a></h4>
<p>If a patient’s data consists of sorted DICOM files, the data may be read
both with <code class="docutils literal notranslate"><span class="pre">unsorted_dicom=False</span></code> (default) and with <code class="docutils literal notranslate"><span class="pre">unsorted_dicom=True</span></code>.
Loading of sorted data tends to be faster, with object linking (for
example, association of a structure set with an image) based
on file organisation.  When loading unsorted DICOM files, object linking
is based on unique identifiers and references that the files contain.</p>
<p>Unsorted DICOM files can be copied as sorted files:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">skrt</span> <span class="kn">import</span> <span class="n">Patient</span>
<span class="c1"># Load unsorted DICOM files.</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">Patient</span><span class="p">(</span><span class="s1">&#39;mypatient2&#39;</span><span class="p">,</span> <span class="n">unsorted_dicom</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># Write sorted DICOM files to sub-directory mypatient2 of directory my_sorted_dicom.</span>
<span class="n">p</span><span class="o">.</span><span class="n">copy_dicom</span><span class="p">(</span><span class="s1">&#39;my_sorted_dicom&#39;</span><span class="p">)</span>
</pre></div>
</div>
<!---
#### Writing a patient tree

A patient's files can be written out in nifti or numpy format. By default, files will be written to compress nifti (`.nii.gz`) files. This is done via the `write` method:
```
p.write('some_dir')
```
where `some_dir` is the directory in which the new patient folder will be created (if not given, it will be created in the current directory).

By default, all imaging modalities will be written. To ignore a specific modality, a list `to_ignore` can be provided, e.g. to ignore any MR images:
```
p.write('some_dir', to_ignore=['MR'])
```

To write out structure sets as well as images, the `structure_set` argument should be set. This can be either:
- `'all'`: write all structure sets.
- The index of the structure set (e.g. to write only the newest structure set for each image, set `structure_set=-1`)
- A list of indices of structure sets to write (e.g. to write only the oldest and newest, set `structure_set=[0, -1]`)

By default, no structure sets will be written, as conversion of structures from contours to masks can be slow for large structures.
--->
</section>
</section>
<section id="the-study-class">
<h3>The Study class<a class="headerlink" href="#the-study-class" title="Permalink to this heading"></a></h3>
<p>A <code class="docutils literal notranslate"><span class="pre">Study</span></code> object stores images and structure sets. A list of studies can be extracted from a <code class="docutils literal notranslate"><span class="pre">Patient</span></code> object via the property <code class="docutils literal notranslate"><span class="pre">Patient.studies</span></code>. You can access the study’s path via <code class="docutils literal notranslate"><span class="pre">Study.path</span></code>. If the study was nested inside a subdirectory, the name of that subdirectory is accessed via <code class="docutils literal notranslate"><span class="pre">Study.subdir</span></code>.</p>
<section id="id1">
<h4>Images<a class="headerlink" href="#id1" title="Permalink to this heading"></a></h4>
<p>For each imaging modalitiy subdirectory inside the study, a new class property will be created to contain a list of images of that modality, called <code class="docutils literal notranslate"><span class="pre">{modality}_images</span></code>, where the modality is taken from the subdirectory name (note, this is always converted to lower case). E.g. if there were directories called <code class="docutils literal notranslate"><span class="pre">CT</span></code> and <code class="docutils literal notranslate"><span class="pre">MR</span></code>, the <code class="docutils literal notranslate"><span class="pre">Study</span></code> object would have properties <code class="docutils literal notranslate"><span class="pre">ct_images</span></code> and <code class="docutils literal notranslate"><span class="pre">mr_images</span></code> containing lists of <code class="docutils literal notranslate"><span class="pre">Image</span></code> objects.</p>
</section>
<section id="structure-sets">
<h4>Structure sets<a class="headerlink" href="#structure-sets" title="Permalink to this heading"></a></h4>
<p>The study’s structure sets can be accessed in two ways. Firstly, the structure sets associated with an image can be extracted from the <code class="docutils literal notranslate"><span class="pre">structure_sets</span></code> property of the <code class="docutils literal notranslate"><span class="pre">Image</span></code> itself; this is a list of <code class="docutils literal notranslate"><span class="pre">StructureSet</span></code> objects. E.g. to get the newest structure set for the oldest CT image in the oldest study, you could run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="n">Patient</span><span class="p">(</span><span class="s1">&#39;mypatient1&#39;</span><span class="p">)</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">studies</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">structure_set</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">ct_images</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">structure_sets</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
<p>In addition, structure sets associated with each imaginging modality will be stored in a property of the <code class="docutils literal notranslate"><span class="pre">Study</span></code> object called <code class="docutils literal notranslate"><span class="pre">{modality}_structure_sets</span></code>. E.g. to get the oldest CT-related structure set, you could run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">structure_set</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">ct_structure_sets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">StructureSet</span></code> object also has an associated <code class="docutils literal notranslate"><span class="pre">image</span></code> property (<code class="docutils literal notranslate"><span class="pre">structure_set.image</span></code>), which can be used to find out which <code class="docutils literal notranslate"><span class="pre">Image</span></code> is associated with that structure set.</p>
</section>
<section id="treatment-plans">
<h4>Treatment plans<a class="headerlink" href="#treatment-plans" title="Permalink to this heading"></a></h4>
<p>Data from radiotherapy treatment plans are made available as <code class="docutils literal notranslate"><span class="pre">Plan</span></code> objects.  <code class="docutils literal notranslate"><span class="pre">Study</span></code> objects group <code class="docutils literal notranslate"><span class="pre">Plan</span></code> objects in lists with names of the form <code class="docutils literal notranslate"><span class="pre">&lt;machine&gt;_plans</span></code>, where <code class="docutils literal notranslate"><span class="pre">&lt;machine&gt;</span></code> identifies the treatment machine to which the plan relates.  <code class="docutils literal notranslate"><span class="pre">Image</span></code> objects and <code class="docutils literal notranslate"><span class="pre">StructureSet</span></code> objects group together all plans associated with them, in a list <code class="docutils literal notranslate"><span class="pre">plans</span></code>.  A <code class="docutils literal notranslate"><span class="pre">Dose</span></code> object is only ever derived from a single plan, referenced as <code class="docutils literal notranslate"><span class="pre">plan</span></code>.  Different ways of accessing a <code class="docutils literal notranslate"><span class="pre">Plan</span></code> object are shown below.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Access plan from Study.</span>
<span class="n">plan</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">la3_plans</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># Access plan from Image to which it relates.</span>
<span class="n">plan</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">ct_images</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plans</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># Access plan from StructureSet to which it relates.</span>
<span class="n">plan</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">ct_structure_sets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plans</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># Access plan from Dose (each of which can relate to only a single plan).</span>
<span class="n">plan</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">ct_doses</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plan</span>
</pre></div>
</div>
<p>Planning information that can then be accessed include the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Obtain plan name.</span>
<span class="n">name</span> <span class="o">=</span> <span class="n">plan</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>

<span class="c1"># Obtain plan approval status.</span>
<span class="n">status</span> <span class="o">=</span> <span class="n">plan</span><span class="o">.</span><span class="n">get_approval_status</span><span class="p">()</span>

<span class="c1"># Obtain planned number of treatment fractions.</span>
<span class="n">n_fraction</span> <span class="o">=</span> <span class="n">plan</span><span class="o">.</span><span class="n">get_n_fraction</span><span class="p">()</span>

<span class="c1"># Obtain planned dose to target (i.e. tumour).</span>
<span class="n">target_dose</span> <span class="o">=</span> <span class="n">plan</span><span class="o">.</span><span class="n">get_target_dose</span><span class="p">()</span>

<span class="c1"># Obtain list of ROI objects defined as targets.</span>
<span class="n">targets</span> <span class="o">=</span> <span class="n">plan</span><span class="o">.</span><span class="n">get_targets</span><span class="p">()</span>

<span class="c1"># For any target, obtain the planning constraints and weight.</span>
<span class="n">target_constraint_weight</span> <span class="o">=</span> <span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">constraint</span><span class="o">.</span><span class="n">weight</span>
<span class="n">target_prescription_dose</span> <span class="o">=</span> <span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">constraint</span><span class="o">.</span><span class="n">prescription_dose</span>
<span class="n">target_maximum_dose</span> <span class="o">=</span> <span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">constraint</span><span class="o">.</span><span class="n">maximum_dose</span>
<span class="n">target_minimum_dose</span> <span class="o">=</span> <span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">constraint</span><span class="o">.</span><span class="n">minimum_dose</span>
<span class="n">target_underdose_volume_fraction</span> <span class="o">=</span> <span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">constraint</span><span class="o">.</span><span class="n">underdose_volume_fraction</span>

<span class="c1"># Obtain list of ROI objects defined as organs at risk.</span>
<span class="n">oars</span> <span class="o">=</span> <span class="n">plan</span><span class="o">.</span><span class="n">get_organs_at_risk</span><span class="p">()</span>

<span class="c1"># For any organ at risk, obtain the planning constraints and weight.</span>
<span class="n">oar_constraint_weight</span> <span class="o">=</span> <span class="n">oars</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">constraint</span><span class="o">.</span><span class="n">weight</span>
<span class="n">oar_maximum_dose</span> <span class="o">=</span> <span class="n">oars</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">constraint</span><span class="o">.</span><span class="n">maximum_dose</span>
<span class="n">oar_full_volume_dose</span> <span class="o">=</span> <span class="n">oars</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">constraint</span><span class="o">.</span><span class="n">full_volume_dose</span>
<span class="n">oar_overdose_volume_fraction</span> <span class="o">=</span> <span class="n">oars</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">constraint</span><span class="o">.</span><span class="n">overdose_volume_fraction</span>

<span class="c1"># For any target or organ at risk, obtain a Dose object, representing</span>
<span class="c1"># a dose objective passed to the optimiser.  Allowed values for the</span>
<span class="c1"># objective correspond to the constraints and weights.</span>
<span class="c1"># Data of the resulting object may be visualised in the same way</span>
<span class="c1"># as for any other Dose object.</span>
<span class="n">max_dose</span> <span class="o">=</span> <span class="n">plan</span><span class="o">.</span><span class="n">get_dose_objective</span><span class="p">(</span><span class="s1">&#39;maximum_dose&#39;</span><span class="p">)</span>
<span class="n">max_dose</span><span class="o">.</span><span class="n">view</span><span class="p">()</span>
</pre></div>
</div>
<p>Example plot of maximum-dose objective:</p>
<img src="_static/maximum_dose.png" alt="Plot of maximum-dose objective" height="400"/>
</section>
</section>
</section>
<section id="synthetic-data">
<h2>4. Synthetic data<a class="headerlink" href="#synthetic-data" title="Permalink to this heading"></a></h2>
<section id="synthetic-images">
<h3>4.1 Synthetic images<a class="headerlink" href="#synthetic-images" title="Permalink to this heading"></a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">SyntheticImage</span></code> class enables the creation of images containing simple geometric shapes.</p>
<img src="_static/synthetic_example.png" alt="synthetic image with a sphere and a cube" height="500"/>
<section id="creating-a-synthetic-image">
<h4>Creating a synthetic image<a class="headerlink" href="#creating-a-synthetic-image" title="Permalink to this heading"></a></h4>
<p>To create an empty image, load the <code class="docutils literal notranslate"><span class="pre">SyntheticImage</span></code> class and specify the desired image shape in order (x, y, z), e.g.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">skrt.simulation</span> <span class="kn">import</span> <span class="n">SyntheticImage</span>

<span class="n">sim</span> <span class="o">=</span> <span class="n">SyntheticImage</span><span class="p">((</span><span class="mi">250</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">50</span><span class="p">))</span>
</pre></div>
</div>
<p>The following arguments can be used to adjust the image’s properties:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">voxel_size</span></code>: voxel sizes in mm in order (x, y, z); default (1, 1, 1).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">origin</span></code>: position of the top-left voxel in mm; default (0, 0, 0).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">intensity</span></code>: value of the background voxels of the image.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">noise_std</span></code>: standard deviation of Gaussian noise to apply to the image. This noise will also be added on top of any shapes. (Can be changed later by altering the <code class="docutils literal notranslate"><span class="pre">sim.noise_std</span></code> property).</p></li>
</ul>
<section id="adding-shapes">
<h5>Adding shapes<a class="headerlink" href="#adding-shapes" title="Permalink to this heading"></a></h5>
<p>The <code class="docutils literal notranslate"><span class="pre">SyntheticImage</span></code> object has various methods for adding geometric shapes. Each shape has the following arguments:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">intensity</span></code>: intensity value with which to fill the voxels of this shape.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">above</span></code>: if <code class="docutils literal notranslate"><span class="pre">True</span></code>, this shape will be overlaid on top of all existing shapes; otherwise, it will be added below all other shapes.</p></li>
</ul>
<p>The available shapes and their specific arguments are:</p>
<ul class="simple">
<li><p><strong>Sphere</strong>: <code class="docutils literal notranslate"><span class="pre">sim.add_sphere(radius,</span> <span class="pre">centre=None)</span></code></p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">radius</span></code>: radius of the sphere in mm.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">centre</span></code>: position of the centre of the sphere in mm (if <code class="docutils literal notranslate"><span class="pre">None</span></code>, the sphere will be placed in the centre of the image).</p></li>
</ul>
</li>
<li><p><strong>Cuboid</strong>: <code class="docutils literal notranslate"><span class="pre">sim.add_cuboid(side_length,</span> <span class="pre">centre=None)</span></code></p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">side_length</span></code>: side length in mm. Can either be a single value (to create a cube) or a list of the (x, y, z) side lengths.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">centre</span></code>: position of the centre of the cuboid in mm (if <code class="docutils literal notranslate"><span class="pre">None</span></code>, the cuboid will be placed in the centre of the image).</p></li>
</ul>
</li>
<li><p><strong>Cube</strong>: <code class="docutils literal notranslate"><span class="pre">sim.add_cube(side_length,</span> <span class="pre">centre=None)</span></code></p>
<ul>
<li><p>Same as <code class="docutils literal notranslate"><span class="pre">add_cuboid</span></code>.</p></li>
</ul>
</li>
<li><p><strong>Cylinder</strong>: <code class="docutils literal notranslate"><span class="pre">sim.add_cylinder(radius,</span> <span class="pre">length,</span> <span class="pre">axis='z',</span> <span class="pre">centre=None)</span></code></p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">radius</span></code>: radius of the cylinder in mm.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">length</span></code>: length of the cylinder in mm.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">axis</span></code>: either <code class="docutils literal notranslate"><span class="pre">'x'</span></code>, <code class="docutils literal notranslate"><span class="pre">'y'</span></code>, or <code class="docutils literal notranslate"><span class="pre">'z'</span></code>; direction along which the length of the cylinder should lie.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">centre</span></code>: position of the centre of the cylinder in mm (if <code class="docutils literal notranslate"><span class="pre">None</span></code>, the cylinder will be placed in the centre of the image).</p></li>
</ul>
</li>
<li><p><strong>Grid</strong>: <code class="docutils literal notranslate"><span class="pre">sim.add_grid(spacing,</span> <span class="pre">thickness=1,</span> <span class="pre">axis=None)</span></code></p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">spacing</span></code>: grid spacing in mm. Can either be a single value, or list of (x, y, z) spacings.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">thickenss</span></code>: gridline thickness in mm. Can either be a single value, or list of (x, y, z) thicknesses.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">axis</span></code>: if None, gridlines will be created in all three directions; if set to <code class="docutils literal notranslate"><span class="pre">'x'</span></code>, <code class="docutils literal notranslate"><span class="pre">'y'</span></code>, or <code class="docutils literal notranslate"><span class="pre">'z'</span></code>, grids will only be created in the plane orthogonal to the chosen axis, such that a solid grid runs through the image along that axis.</p></li>
</ul>
</li>
</ul>
<p>To remove all shapes from the image, run</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sim</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="id2">
<h5>Plotting<a class="headerlink" href="#id2" title="Permalink to this heading"></a></h5>
<p>The <code class="docutils literal notranslate"><span class="pre">SyntheticImage</span></code> class inherits from the <code class="docutils literal notranslate"><span class="pre">Image</span></code> class, and can thus be plotted in the same way by calling</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sim</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
<p>along with any of the arguments available to the <code class="docutils literal notranslate"><span class="pre">Image</span></code> plotting method.</p>
</section>
<section id="rotations-and-translations">
<h5>Rotations and translations<a class="headerlink" href="#rotations-and-translations" title="Permalink to this heading"></a></h5>
<p>Rotations and translations can be applied to the image using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sim</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">dz</span><span class="p">)</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sim</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">pitch</span><span class="p">,</span> <span class="n">yaw</span><span class="p">,</span> <span class="n">roll</span><span class="p">)</span>
</pre></div>
</div>
<p>Rotations and translations can be removed by running</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sim</span><span class="o">.</span><span class="n">reset_transforms</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="getting-the-image-array">
<h5>Getting the image array<a class="headerlink" href="#getting-the-image-array" title="Permalink to this heading"></a></h5>
<p>To obtain a NumPy array containing the image data, run</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">array</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>
</pre></div>
</div>
<p>This array will contain all of the added shapes, as well as having any rotations, translations, and noise applied.</p>
</section>
<section id="saving">
<h5>Saving<a class="headerlink" href="#saving" title="Permalink to this heading"></a></h5>
<p>The synthetic image can be written to an image file by running</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sim</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">outname</span><span class="p">)</span>
</pre></div>
</div>
<p>The output name <code class="docutils literal notranslate"><span class="pre">outname</span></code> can be:</p>
<ul class="simple">
<li><p>A path ending in <code class="docutils literal notranslate"><span class="pre">.nii</span></code> or <code class="docutils literal notranslate"><span class="pre">.nii.gz</span></code>: image will be written to a nifti file.</p></li>
<li><p>A path ending in <code class="docutils literal notranslate"><span class="pre">.npy</span></code>: image will be written to a binary NumPy file.</p></li>
<li><p>A path to a directory: image will be written to dicom files (one file per slice) inside the directory.</p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">write</span></code> function can also take any of the arguments of the <code class="docutils literal notranslate"><span class="pre">Image.write()</span></code> function.</p>
</section>
</section>
<section id="adding-structures">
<h4>Adding structures<a class="headerlink" href="#adding-structures" title="Permalink to this heading"></a></h4>
<p>When shapes are added to the image, they can also be set as ROIs. This allows you to:</p>
<ul class="simple">
<li><p>Plot them as contours or masks on top of the image;</p></li>
<li><p>Access a <code class="docutils literal notranslate"><span class="pre">StructureSet</span></code> object containing the ROIs;</p></li>
<li><p>Write ROIs out separately as masks or as a dicom structure set file.</p></li>
</ul>
<section id="single-rois">
<h5>Single ROIs<a class="headerlink" href="#single-rois" title="Permalink to this heading"></a></h5>
<p>To assign a shape as an ROI, you can either give it a name upon creation, e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sim</span><span class="o">.</span><span class="n">add_sphere</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;my_sphere&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>or set the <code class="docutils literal notranslate"><span class="pre">is_roi</span></code> property to <code class="docutils literal notranslate"><span class="pre">True</span></code> (the ROI will then be given an automatic named based on its shape type):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sim</span><span class="o">.</span><span class="n">add_sphere</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="n">is_roi</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>When <code class="docutils literal notranslate"><span class="pre">sim.plot()</span></code> is called, its ROIs will automatically be plotted as contours. Some useful extra options to the <code class="docutils literal notranslate"><span class="pre">plot</span></code> function are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">roi_plot_type</span></code>: set plot type to any of the valid <code class="docutils literal notranslate"><span class="pre">ROI</span></code> plotting types (mask, contour, filled, centroid, filled centroid).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">centre_on_roi</span></code>: name of ROI on which the plotted image should be centred.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">roi_legend</span></code>: set to <code class="docutils literal notranslate"><span class="pre">True</span></code> to draw a legend containing the strutcure names.</p></li>
</ul>
</section>
<section id="grouped-shapes">
<h5>Grouped shapes<a class="headerlink" href="#grouped-shapes" title="Permalink to this heading"></a></h5>
<p>Multiple shapes can be combined to create a single ROI. To do this, set the <code class="docutils literal notranslate"><span class="pre">group</span></code> argument to some string when creating shapes. Any shapes created with the same <code class="docutils literal notranslate"><span class="pre">group</span></code> name will be added to this group.</p>
<p>E.g. to create a single ROI called “two_cubes” out of two cubes centred at different positions, run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sim</span><span class="o">.</span><span class="n">add_cube</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">centre</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">group</span><span class="o">=</span><span class="s1">&#39;two_cubes&#39;</span><span class="p">)</span>
<span class="n">sim</span><span class="o">.</span><span class="n">add_cube</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">centre</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span> <span class="n">group</span><span class="o">=</span><span class="s1">&#39;two_cubes&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id3">
<h5>Getting ROIs<a class="headerlink" href="#id3" title="Permalink to this heading"></a></h5>
<p>To get a <code class="docutils literal notranslate"><span class="pre">StructureSet</span></code> object containing all of the ROIs belonging to the image, run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">structure_set</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">get_structure_set</span><span class="p">()</span>
</pre></div>
</div>
<p>You can also access a single ROI as an <code class="docutils literal notranslate"><span class="pre">ROI</span></code> object by running:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">roi</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">get_roi</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="saving-rois">
<h5>Saving ROIs<a class="headerlink" href="#saving-rois" title="Permalink to this heading"></a></h5>
<p>When the <code class="docutils literal notranslate"><span class="pre">SyntheticImage.write()</span></code> function is called, the ROIs belonging to that image will also be written. If the provided <code class="docutils literal notranslate"><span class="pre">outname</span></code> is that of a nifti or NumPy file, the ROIs will be written to nifti or Numpy files, respectively, inside a directory with the same name as <code class="docutils literal notranslate"><span class="pre">outname</span></code> but with the extension removed.</p>
</section>
</section>
</section>
<section id="synthetic-patient-objects">
<h3>4.2 Synthetic Patient objects<a class="headerlink" href="#synthetic-patient-objects" title="Permalink to this heading"></a></h3>
<p>The Patient class can be used to create a custom patient object from scratch, rather than loading a prexisting patient.</p>
<p>To do this, first create a blank Patient object with your chosen ID:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">skrt</span> <span class="kn">import</span> <span class="n">Patient</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">Patient</span><span class="p">(</span><span class="s2">&quot;my_id&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Studies can then be added to this object. Optional arguments for adding a study are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">subdir</span></code>: a custom subdirectory in which the study will be nested when the Patient tree is written;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">timestamp</span></code>: a custom timestamp (if not set, this will be automatically generated)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">images</span></code>: a list of Image objects to associate with this study (note, Images can also be added to the Study later)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">image_type</span></code>: the type of image correspoding to the Images in <code class="docutils literal notranslate"><span class="pre">images</span></code>, if used (e.g. <code class="docutils literal notranslate"><span class="pre">CT</span></code>); this will determine the name of the directory in which the images are saved when the Patient tree is written.</p></li>
</ul>
<p>E.g. to add one study containing a single synthetic image with one ROI:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">skrt.simulation</span> <span class="kn">import</span> <span class="n">SyntheticImage</span>

<span class="n">im</span> <span class="o">=</span> <span class="n">SyntheticImage</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">30</span><span class="p">))</span>
<span class="n">im</span><span class="o">.</span><span class="n">add_sphere</span><span class="p">(</span><span class="n">radius</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;my_sphere&quot;</span><span class="p">)</span>

<span class="n">p</span><span class="o">.</span><span class="n">add_study</span><span class="p">(</span><span class="s2">&quot;my_study&quot;</span><span class="p">,</span> <span class="n">images</span><span class="o">=</span><span class="p">[</span><span class="n">im</span><span class="p">],</span> <span class="n">image_type</span><span class="o">=</span><span class="s2">&quot;MR&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The patient tree can then be written out:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">p</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">outdir</span><span class="o">=</span><span class="s2">&quot;some_dir&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>This will create a patient directory <code class="docutils literal notranslate"><span class="pre">somedir/my_id</span></code> containing the added study and its corresponding image and structure set.</p>
</section>
<section id="image-registration">
<h3>5. Image registration<a class="headerlink" href="#image-registration" title="Permalink to this heading"></a></h3>
<p>See tutorial <a class="reference internal" href="image_registration.html"><span class="std std-doc">here</span></a></p>
</section>
<section id="keyboard-shortcuts-for-pop-out-interactive-viewer">
<h3>6. Keyboard shortcuts for pop-out interactive viewer<a class="headerlink" href="#keyboard-shortcuts-for-pop-out-interactive-viewer" title="Permalink to this heading"></a></h3>
<p>A minimal pop-up interactive viewer can be created by running <code class="docutils literal notranslate"><span class="pre">.view()</span></code> on any <code class="docutils literal notranslate"><span class="pre">Image</span></code>, <code class="docutils literal notranslate"><span class="pre">Dose</span></code>, <code class="docutils literal notranslate"><span class="pre">ROI</span></code> or <code class="docutils literal notranslate"><span class="pre">StructureSet</span></code> from python outside of a jupyter notebook. The controls are:</p>
<ul class="simple">
<li><p>scroll: move 1 slice</p></li>
<li><p>left/right keys: move 1 slice</p></li>
<li><p>up/down keys: move 5 slices</p></li>
<li><p>v: toggle orientation between axial, sagittal, and coronal</p></li>
<li><p>d: toggle dose field opacity (if viewing dose field overlaid on image)</p></li>
<li><p>c: toggle ROI plotting type between contour, filled, and mask (if viewing ROIs)</p></li>
<li><p>j: jump between ROIs (if viewing a <code class="docutils literal notranslate"><span class="pre">StructureSet</span></code>)</p></li>
</ul>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Scikit-rt" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="image_registration.html" class="btn btn-neutral float-right" title="Image registration with scikit-rt and elastix" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>